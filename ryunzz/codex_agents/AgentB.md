# Agent B (Labeling Spec)

## Design Decisions
- Documented the `docs/label_flow_alignment.md` checklist with sections for touchpoints, invariants, and pass/fail actions so Agent A can align implementations without guessing.
- Highlighted sampling, prompt/rules, class filtering, and tiny-box stability as the core invariants that must remain visible in tooling.
- Kept documentation separate from code so changes can be discussed without touching CLI logic.

## Assumptions
- The authoritative class list lives in `LABELING_RULES.md`; all tooling must defer to it via `rules.py` or direct imports.
- Active CLI path consumes `frames.json` generated by `extract-frames`; no separate start/step/limit sampler is in `labeler` flow.
- The `docs/label_flow_alignment.md` document serves as the negotiation point for labeling behavior.

## Interaction Notes
- Agent A reads and responds to action items in the checklist to resolve gaps (e.g., sampling parity, class/drift checks, tiny-box filtering).
- Agent C references this document when writing testing instructions so tests cover the same invariants.

## Deliverables
- `docs/label_flow_alignment.md` (touchpoints, invariants, pass/fail actions, unresolved questions).
- Periodic updates to note resolved gaps or new integration decisions.

## Next Handoff
- Review updated `label_frames.py`/CLI changes to ensure checklist matches reality.
- Highlight remaining unresolved questions so future agents can pick them up.

## Refresh Notes (2026-02-05)
- Re-scanned current shared path and refreshed checklist at `/Users/ryunzz/_projects/yolodex/docs/label_flow_alignment.md`.
- Confirmed resolved in active CLI path:
- shared `detect` logic now used by workers (`label_worker` -> `label_frames.detect`)
- class filtering and `<2px` tiny-box filter occur in shared detect layer
- validation is now rules-aware for class order and label/image stem parity
- Confirmed partial/remaining risks:
- prompt currently injects only `Global Rules` excerpt from `LABELING_RULES.md`, not edge-case/class-definition sections
- `merge` does not currently take `--rules`; custom rules workflows can drift unless merge class source is pinned
- Added explicit action item for Agent A to verify CLI `--rules` propagation with pass/fail cues.

## Re-Verification (2026-02-05, later pass)
- Re-opened `label_frames.py`, `rules.py`, `cli.py`, `merge.py`, and `validate.py`.
- No new resolved gaps or regressions since the prior refresh; checklist remains accurate.
- Risk status unchanged:
- `merge` still has no `--rules` argument.
- prompt remains global-rules excerpt only (no direct edge-case/class-definition injection).
